<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–∫–æ–ª–∞ 105 - –ö–∞–±–∏–Ω–µ—Ç –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è */
        .nav-item {
          background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
          border: none;
          cursor: pointer;
          transition: all 0.3s ease;
        }

        .nav-item:hover {
          transform: translateY(-2px);
          box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
        }

        .nav-item.active {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          box-shadow: 0 5px 15px -3px rgba(0, 0, 0, 0.3);
        }

        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        @keyframes scaleIn {
          from {
            opacity: 0;
            transform: scale(0.9);
          }
          to {
            opacity: 1;
            transform: scale(1);
          }
        }

        .animate-fade-in {
          animation: fadeIn 0.8s ease-out;
        }

        .animate-slide-up {
          animation: slideUp 0.8s ease-out;
        }

        .animate-scale-in {
          animation: scaleIn 0.6s ease-out;
        }

        .class-card {
          transition: all 0.3s ease;
        }

        .class-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
        }

        .lesson-card {
          transition: all 0.3s ease;
        }

        .lesson-card:hover {
          transform: scale(1.05);
        }

        .resource-card {
          transition: all 0.3s ease;
        }

        .resource-card:hover {
          transform: translateY(-3px);
          box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.15);
        }

        .page {
          display: none;
          opacity: 0;
          transform: translateY(20px);
          transition: all 0.5s ease;
        }

        .page.active {
          display: block;
          opacity: 1;
          transform: translateY(0);
        }

        #auth-modal,
        #qa-modal {
          transition: opacity 0.3s ease;
        }

        button {
          transition: all 0.3s ease;
        }

        body[data-theme="night"] {
          background-color: #111827;
          color: #f3f4f6;
        }

        body[data-theme="night"] .bg-white {
          background-color: #1f2937 !important;
        }

        body[data-theme="night"] .text-gray-900 {
          color: #f9fafb !important;
        }

        body[data-theme="night"] .text-gray-700 {
          color: #e5e7eb !important;
        }

        body[data-theme="night"] .text-gray-600 {
          color: #d1d5db !important;
        }

        body[data-theme="night"] .border-gray-200 {
          border-color: #374151 !important;
        }

        body[data-theme="night"] .bg-blue-50 {
          background-color: #1e3a8a !important;
        }

        body[data-theme="night"] .bg-red-50 {
          background-color: #7f1d1d !important;
        }

        body[data-theme="night"] .bg-green-50 {
          background-color: #14532d !important;
        }

        body[data-theme="night"] .bg-yellow-50 {
          background-color: #713f12 !important;
        }

        body,
        .bg-white,
        .text-gray-900,
        .text-gray-700,
        .text-gray-600,
        .border-gray-200,
        .bg-blue-50,
        .bg-red-50,
        .bg-green-50,
        .bg-yellow-50 {
          transition: all 0.5s ease;
        }

        @media (max-width: 768px) {
          .container {
            padding-left: 1rem;
            padding-right: 1rem;
          }
          
          button, 
          .nav-item,
          [data-page] {
            min-height: 44px;
            min-width: 44px;
          }
          
          .text-sm {
            font-size: 0.875rem;
            line-height: 1.25rem;
          }
          
          .space-y-3 > * + * {
            margin-top: 0.75rem;
          }
          
          .gap-4 {
            gap: 1rem;
          }
        }

        @media (max-width: 768px) {
          input, select, textarea {
            font-size: 16px;
          }
        }

        ::-webkit-scrollbar {
          width: 6px;
        }

        ::-webkit-scrollbar-track {
          background: #f1f1f1;
          border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
          background: #c1c1c1;
          border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
          background: #a8a8a8;
        }

        .teacher-modal {
          max-width: 600px;
        }
        
        .teacher-info {
          display: flex;
          flex-direction: column;
          align-items: center;
          text-align: center;
        }
        
        .teacher-photo {
          width: 150px;
          height: 150px;
          border-radius: 50%;
          object-fit: cover;
          margin-bottom: 1rem;
          border: 4px solid #3b82f6;
        }
        
        .teacher-details {
          margin-top: 1rem;
          text-align: left;
        }
        
        .teacher-details p {
          margin-bottom: 0.5rem;
        }
        
        /* Practice page styles */
        .practice-level {
          background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
          color: white;
          border-radius: 12px;
          padding: 1.5rem;
          margin-bottom: 1.5rem;
          transition: all 0.3s ease;
          cursor: pointer;
        }
        
        .practice-level:hover {
          transform: translateY(-5px);
          box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
        }
        
        .practice-level.locked {
          background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
          cursor: not-allowed;
        }
        
        .practice-exercise {
          background: white;
          border-radius: 12px;
          padding: 1.5rem;
          margin-bottom: 1.5rem;
          box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
          border: 1px solid #e5e7eb;
        }
        
        .character-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
          gap: 1rem;
          margin: 1rem 0;
        }
        
        .character-card {
          background: #f3f4f6;
          border-radius: 8px;
          padding: 1rem;
          text-align: center;
          font-size: 1.5rem;
          cursor: pointer;
          transition: all 0.2s ease;
        }
        
        .character-card:hover {
          background: #e5e7eb;
          transform: scale(1.05);
        }
        
        .character-card.correct {
          background: #10b981;
          color: white;
        }
        
        .character-card.incorrect {
          background: #ef4444;
          color: white;
        }
        
        .progress-bar {
          height: 10px;
          background: #e5e7eb;
          border-radius: 5px;
          overflow: hidden;
          margin: 1rem 0;
        }
        
        .progress-fill {
          height: 100%;
          background: #10b981;
          transition: width 0.3s ease;
        }
        
        .exercise-complete {
          text-align: center;
          padding: 2rem;
          background: #f0fdf4;
          border-radius: 12px;
          border: 2px solid #10b981;
        }
        
        .lesson-complete {
          background: linear-gradient(135deg, #10b981 0%, #059669 100%);
          color: white;
        }
        
        .lesson-current {
          background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
          color: white;
          position: relative;
        }
        
        .lesson-current::after {
          content: "–¢–µ–∫—É—â–∏–π —É—Ä–æ–∫";
          position: absolute;
          top: -10px;
          right: -10px;
          background: #ef4444;
          color: white;
          padding: 4px 8px;
          border-radius: 20px;
          font-size: 0.75rem;
        }
        
        .lesson-locked {
          background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
          color: white;
          cursor: not-allowed;
        }
        
        .lesson-item {
          padding: 1.5rem;
          border-radius: 12px;
          margin-bottom: 1rem;
          transition: all 0.3s ease;
          cursor: pointer;
        }
        
        .lesson-item:hover:not(.lesson-locked) {
          transform: translateY(-3px);
          box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="bg-white text-gray-900" data-theme="day">
    <!-- Notification -->
    <div id="notification" class="fixed top-4 right-4 z-50 max-w-sm hidden">
        <div class="bg-white rounded-xl shadow-2xl p-4 border-l-4 border-green-500 transform transition-all duration-500 translate-x-full">
            <div class="flex items-center">
                <i data-feather="check-circle" class="w-6 h-6 text-green-500 mr-3"></i>
                <div class="flex-1">
                    <p id="notification-text" class="text-gray-900 font-medium"></p>
                </div>
                <button onclick="hideNotification()" class="text-gray-400 hover:text-gray-600 ml-4">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 id="modal-title" class="text-2xl font-bold text-gray-800">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h3>
                        <button onclick="closeModal('auth-modal')" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-6 h-6"></i>
                        </button>
                    </div>

                    <!-- Login Form -->
                    <div id="login-form">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–õ–æ–≥–∏–Ω</label>
                                <input type="text" id="login-username" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ª–æ–≥–∏–Ω">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–ü–∞—Ä–æ–ª—å</label>
                                <input type="password" id="login-password" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å">
                            </div>
                            <button onclick="login()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-medium hover:bg-blue-700 transition-all duration-300 flex items-center justify-center">
                                <i data-feather="log-in" class="w-5 h-5 mr-2"></i>
                                –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
                            </button>
                            <div class="text-center">
                                <button onclick="forgotPassword()" class="text-blue-600 hover:text-blue-700 text-sm">
                                    –ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?
                                </button>
                            </div>
                            <div class="text-center pt-4 border-t border-gray-200">
                                <p class="text-gray-600 text-sm">
                                    –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? 
                                    <button onclick="openAuthModal('register')" class="text-blue-600 hover:text-blue-700 font-medium">
                                        –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                                    </button>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Register Form -->
                    <div id="register-form" class="hidden">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–õ–æ–≥–∏–Ω</label>
                                <input type="text" id="reg-username" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–ü–∞—Ä–æ–ª—å</label>
                                <input type="password" id="reg-password" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                                <input type="password" id="reg-confirm-password" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–†–æ–ª—å</label>
                                <select id="reg-role" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="student">üéí –£—á–µ–Ω–∏–∫</option>
                                    <option value="teacher">üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å</option>
                                </select>
                            </div>
                            <button onclick="register()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-medium hover:bg-blue-700 transition-all duration-300 flex items-center justify-center">
                                <i data-feather="user-plus" class="w-5 h-5 mr-2"></i>
                                –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                            </button>
                            <div class="text-center pt-4 border-t border-gray-200">
                                <p class="text-gray-600 text-sm">
                                    –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? 
                                    <button onclick="openAuthModal('login')" class="text-blue-600 hover:text-blue-700 font-medium">
                                        –í–æ–π—Ç–∏
                                    </button>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Q&A Modal -->
    <div id="qa-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-800">–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã</h3>
                        <button onclick="closeModal('qa-modal')" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-6 h-6"></i>
                        </button>
                    </div>

                    <!-- Ask Question -->
                    <div class="mb-6">
                        <textarea id="question-input" placeholder="–ó–∞–¥–∞–π—Ç–µ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å —É—á–∏—Ç–µ–ª—é..." class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 h-24 resize-none"></textarea>
                        <button onclick="submitQuestion()" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-medium mt-3 hover:bg-blue-700 transition-all duration-300 flex items-center">
                            <i data-feather="send" class="w-5 h-5 mr-2"></i>
                            –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                        </button>
                    </div>

                    <!-- Questions List -->
                    <div id="qa-list" class="space-y-4 max-h-64 overflow-y-auto">
                        <!-- Questions will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Teacher Modal -->
    <div id="add-teacher-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-800">–î–æ–±–∞–≤–∏—Ç—å —É—á–∏—Ç–µ–ª—è</h3>
                        <button onclick="closeModal('add-teacher-modal')" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-6 h-6"></i>
                        </button>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–ò–º—è —É—á–∏—Ç–µ–ª—è</label>
                            <input type="text" id="teacher-name" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –∏–º—è">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–õ–æ–≥–∏–Ω</label>
                            <input type="text" id="teacher-login" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="teacher-password" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                        </div>
                        <button onclick="addTeacher()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-medium hover:bg-blue-700 transition-all duration-300 flex items-center justify-center">
                            <i data-feather="user-plus" class="w-5 h-5 mr-2"></i>
                            –î–æ–±–∞–≤–∏—Ç—å —É—á–∏—Ç–µ–ª—è
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Class Modal -->
    <div id="add-class-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-800">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∞—Å—Å</h3>
                        <button onclick="closeModal('add-class-modal')" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-6 h-6"></i>
                        </button>
                    </div>

                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–ö–ª–∞—Å—Å</label>
                                <select id="class-grade" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="1">1 –∫–ª–∞—Å—Å</option>
                                    <option value="2">2 –∫–ª–∞—Å—Å</option>
                                    <option value="3">3 –∫–ª–∞—Å—Å</option>
                                    <option value="4">4 –∫–ª–∞—Å—Å</option>
                                    <option value="5">5 –∫–ª–∞—Å—Å</option>
                                    <option value="6">6 –∫–ª–∞—Å—Å</option>
                                    <option value="7">7 –∫–ª–∞—Å—Å</option>
                                    <option value="8">8 –∫–ª–∞—Å—Å</option>
                                    <option value="9">9 –∫–ª–∞—Å—Å</option>
                                    <option value="10">10 –∫–ª–∞—Å—Å</option>
                                    <option value="11">11 –∫–ª–∞—Å—Å</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">–ë—É–∫–≤–∞</label>
                                <select id="class-letter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="–ê">–ê</option>
                                    <option value="–ë">–ë</option>
                                    <option value="–í">–í</option>
                                    <option value="–ì">–ì</option>
                                    <option value="–î">–î</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="addClass()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-medium hover:bg-blue-700 transition-all duration-300 flex items-center justify-center">
                            <i data-feather="plus" class="w-5 h-5 mr-2"></i>
                            –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∞—Å—Å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Teacher Info Modal -->
    <div id="teacher-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md teacher-modal">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 id="teacher-modal-title" class="text-2xl font-bold text-gray-800">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—á–∏—Ç–µ–ª–µ</h3>
                        <button onclick="closeModal('teacher-modal')" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <div id="teacher-modal-content">
                        <!-- Teacher info will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-blue-600 text-white shadow-2xl sticky top-0 z-40" id="main-header">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="bg-white/20 p-2 rounded-xl">
                        <i data-feather="book-open" class="w-6 h-6 sm:w-7 sm:h-7"></i>
                    </div>
                    <div>
                        <h1 class="text-xl sm:text-2xl font-bold">–®–∫–æ–ª–∞ 105</h1>
                        <p class="text-blue-100 text-xs sm:text-sm hidden sm:block">–ö–∞–±–∏–Ω–µ—Ç –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <button id="theme-toggle" class="bg-white/20 p-2 sm:p-3 rounded-xl hover:bg-white/30 transition-all duration-300">
                        <i data-feather="moon" class="w-4 h-4 sm:w-5 sm:h-5"></i>
                    </button>
                    
                    <button id="qa-button" class="bg-white/20 p-2 sm:p-3 rounded-xl hover:bg-white/30 transition-all duration-300 hidden">
                        <i data-feather="message-circle" class="w-4 h-4 sm:w-5 sm:h-5"></i>
                    </button>
                    
                    <div id="auth-buttons" class="hidden md:flex space-x-2 sm:space-x-3">
                        <!-- Auth buttons will be loaded here -->
                    </div>
                </div>
                
                <button id="mobile-menu-button" class="md:hidden p-2 bg-white/20 rounded-lg">
                    <i data-feather="menu" class="w-5 h-5"></i>
                </button>
            </div>
            
            <!-- Desktop Navigation -->
            <nav class="mt-4 hidden md:block">
                <div class="flex flex-wrap justify-center gap-2 sm:gap-3">
                    <button data-page="main" class="nav-item px-4 py-2 sm:px-5 sm:py-2.5 rounded-xl font-medium text-white active text-sm sm:text-base">–ì–ª–∞–≤–Ω–∞—è</button>
                    <button data-page="teachers" class="nav-item px-4 py-2 sm:px-5 sm:py-2.5 rounded-xl font-medium text-white text-sm sm:text-base">–£—á–∏—Ç–µ–ª—è</button>
                    <button data-page="classes" class="nav-item px-4 py-2 sm:px-5 sm:py-2.5 rounded-xl font-medium text-white text-sm sm:text-base">–ö–ª–∞—Å—Å—ã</button>
                    <button data-page="lessons" class="nav-item px-4 py-2 sm:px-5 sm:py-2.5 rounded-xl font-medium text-white text-sm sm:text-base">–ó–∞–Ω—è—Ç–∏—è</button>
                    <button data-page="practice" class="nav-item px-4 py-2 sm:px-5 sm:py-2.5 rounded-xl font-medium text-white text-sm sm:text-base">–ü—Ä–∞–∫—Ç–∏–∫–∞</button>
                    <button data-page="resources" class="nav-item px-4 py-2 sm:px-5 sm:py-2.5 rounded-xl font-medium text-white text-sm sm:text-base">–†–µ—Å—É—Ä—Å—ã</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="hidden bg-blue-800 text-white py-4 px-4 md:hidden">
        <div class="flex flex-col space-y-3">
            <button data-page="main" class="px-4 py-3 rounded-xl hover:bg-white/10 flex items-center transition-all duration-300 text-base">
                <i data-feather="home" class="w-4 h-4 mr-3"></i>–ì–ª–∞–≤–Ω–∞—è
            </button>
            <button data-page="teachers" class="px-4 py-3 rounded-xl hover:bg-white/10 flex items-center transition-all duration-300 text-base">
                <i data-feather="users" class="w-4 h-4 mr-3"></i>–£—á–∏—Ç–µ–ª—è
            </button>
            <button data-page="classes" class="px-4 py-3 rounded-xl hover:bg-white/10 flex items-center transition-all duration-300 text-base">
                <i data-feather="layers" class="w-4 h-4 mr-3"></i>–ö–ª–∞—Å—Å—ã
            </button>
            <button data-page="lessons" class="px-4 py-3 rounded-xl hover:bg-white/10 flex items-center transition-all duration-300 text-base">
                <i data-feather="clock" class="w-4 h-4 mr-3"></i>–ó–∞–Ω—è—Ç–∏—è
            </button>
            <button data-page="practice" class="px-4 py-3 rounded-xl hover:bg-white/10 flex items-center transition-all duration-300 text-base">
                <i data-feather="activity" class="w-4 h-4 mr-3"></i>–ü—Ä–∞–∫—Ç–∏–∫–∞
            </button>
            <button data-page="resources" class="px-4 py-3 rounded-xl hover:bg-white/10 flex items-center transition-all duration-300 text-base">
                <i data-feather="book" class="w-4 h-4 mr-3"></i>–†–µ—Å—É—Ä—Å—ã
            </button>
            <div class="pt-4 border-t border-blue-600 space-y-3" id="mobile-auth-section">
                <!-- Mobile auth buttons will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main id="main-page" class="page container mx-auto px-4 py-6 sm:py-8 active">
        <section class="text-center mb-8 sm:mb-12 animate-fade-in">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900 mb-4">–ö–∞–±–∏–Ω–µ—Ç <span class="text-blue-600">–∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</span></h1>
            <p class="text-lg sm:text-xl text-gray-700 max-w-2xl mx-auto">–ò–∑—É—á–∞–µ–º –∫–∏—Ç–∞–π—Å–∫–∏–π —è–∑—ã–∫ –∏ –∫—É–ª—å—Ç—É—Ä—É –ö–∏—Ç–∞—è</p>
        </section>

        <section class="max-w-4xl mx-auto bg-blue-600 text-white p-6 sm:p-8 rounded-2xl shadow-lg mb-8 sm:mb-12 animate-slide-up">
            <div class="flex items-center mb-4 sm:mb-6">
                <div class="bg-white/20 p-2 sm:p-3 rounded-xl mr-3 sm:mr-4">
                    <i data-feather="info" class="w-5 h-5 sm:w-6 sm:h-6"></i>
                </div>
                <h2 class="text-xl sm:text-2xl font-bold">–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã –æ –ö–∏—Ç–∞–µ</h2>
            </div>
            <div id="china-facts" class="min-h-[100px] sm:min-h-[140px] flex items-center justify-center">
                <div id="fact-container" class="text-center">
                    <p class="text-lg sm:text-xl font-medium">–ö–∏—Ç–∞–π - —Å–∞–º–∞—è –Ω–∞—Å–µ–ª—ë–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞ –≤ –º–∏—Ä–µ</p>
                </div>
            </div>
        </section>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-6 mb-8 sm:mb-12">
            <div class="bg-blue-50 p-4 sm:p-6 rounded-2xl shadow-lg border border-blue-100 animate-fade-in">
                <div class="flex items-center mb-3 sm:mb-4">
                    <div class="bg-blue-100 p-2 sm:p-3 rounded-xl mr-3 sm:mr-4">
                        <i data-feather="calendar" class="w-5 h-5 sm:w-6 sm:h-6 text-blue-600"></i>
                    </div>
                    <h3 class="font-semibold text-blue-600 text-base sm:text-lg">–ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–Ω—è—Ç–∏—è</h3>
                </div>
                <p class="text-gray-800 font-medium text-sm sm:text-base">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 9:00 - –ö–∏—Ç–∞–π—Å–∫–∏–π –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö</p>
            </div>
            
            <div class="bg-red-50 p-4 sm:p-6 rounded-2xl shadow-lg border border-red-100 animate-fade-in">
                <div class="flex items-center mb-3 sm:mb-4">
                    <div class="bg-red-100 p-2 sm:p-3 rounded-xl mr-3 sm:mr-4">
                        <i data-feather="award" class="w-5 h-5 sm:w-6 sm:h-6 text-red-600"></i>
                    </div>
                    <h3 class="font-semibold text-red-600 text-base sm:text-lg">–ù–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
                </div>
                <p class="text-gray-800 font-medium text-sm sm:text-base">15 –ø—Ä–∏–∑–µ—Ä–æ–≤ –≥–æ—Ä–æ–¥—Å–∫–æ–π –æ–ª–∏–º–ø–∏–∞–¥—ã</p>
            </div>
            
            <div class="bg-green-50 p-4 sm:p-6 rounded-2xl shadow-lg border border-green-100 animate-fade-in">
                <div class="flex items-center mb-3 sm:mb-4">
                    <div class="bg-green-100 p-2 sm:p-3 rounded-xl mr-3 sm:mr-4">
                        <i data-feather="users" class="w-5 h-5 sm:w-6 sm:h-6 text-green-600"></i>
                    </div>
                    <h3 class="font-semibold text-green-600 text-base sm:text-lg">–ù–∞—à–∏ —É—á–∏—Ç–µ–ª—è</h3>
                </div>
                <p class="text-gray-800 font-medium text-sm sm:text-base">5 –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π —Å –æ–ø—ã—Ç–æ–º —Ä–∞–±–æ—Ç—ã –≤ –ö–∏—Ç–∞–µ</p>
            </div>
        </div>
        
        <!-- China Images Section -->
        <section class="mt-12">
            <h2 class="text-2xl sm:text-3xl font-bold text-center mb-8 text-gray-900">–ö–∏—Ç–∞–π—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="h-48 bg-gradient-to-br from-red-500 to-yellow-500 flex items-center justify-center">
                        <i data-feather="home" class="w-16 h-16 text-white"></i>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg mb-2">–í–µ–ª–∏–∫–∞—è –ö–∏—Ç–∞–π—Å–∫–∞—è —Å—Ç–µ–Ω–∞</h3>
                        <p class="text-gray-600">–ö—Ä—É–ø–Ω–µ–π—à–∏–π –ø–∞–º—è—Ç–Ω–∏–∫ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –ø—Ä–æ—Ç—è–∂–µ–Ω–Ω–æ—Å—Ç—å—é –±–æ–ª–µ–µ 21 000 –∫–º</p>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="h-48 bg-gradient-to-br from-green-500 to-blue-500 flex items-center justify-center">
                        <i data-feather="book" class="w-16 h-16 text-white"></i>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg mb-2">–ö–∏—Ç–∞–π—Å–∫–∞—è –ø–∏—Å—å–º–µ–Ω–Ω–æ—Å—Ç—å</h3>
                        <p class="text-gray-600">–û–¥–Ω–∞ –∏–∑ –¥—Ä–µ–≤–Ω–µ–π—à–∏—Ö —Å–∏—Å—Ç–µ–º –ø–∏—Å—å–º–∞, –Ω–∞—Å—á–∏—Ç—ã–≤–∞—é—â–∞—è –±–æ–ª–µ–µ 50 000 –∏–µ—Ä–æ–≥–ª–∏—Ñ–æ–≤</p>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <div class="h-48 bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">
                        <i data-feather="coffee" class="w-16 h-16 text-white"></i>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg mb-2">–ö–∏—Ç–∞–π—Å–∫–∞—è —á–∞–π–Ω–∞—è —Ü–µ—Ä–µ–º–æ–Ω–∏—è</h3>
                        <p class="text-gray-600">–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –∏ –ø–æ–¥–∞—á–∏ —á–∞—è</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Teachers Page -->
    <div id="teachers-page" class="page container mx-auto px-4 py-6 sm:py-8 hidden">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6 sm:mb-8">
            <h2 class="text-2xl sm:text-3xl font-bold text-center sm:text-left text-gray-900">–ù–∞—à–∏ —É—á–∏—Ç–µ–ª—è</h2>
            <button onclick="openModal('add-teacher-modal')" class="bg-blue-600 text-white px-4 py-2 sm:px-6 sm:py-3 rounded-xl font-medium hover:bg-blue-700 transition-all duration-300 hidden w-full sm:w-auto text-sm sm:text-base" id="add-teacher-btn">
                üë®‚Äçüè´ –î–æ–±–∞–≤–∏—Ç—å —É—á–∏—Ç–µ–ª—è
            </button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6" id="teachers-container">
            <!-- Teachers will be loaded here -->
        </div>
    </div>

    <!-- Classes Page -->
    <div id="classes-page" class="page container mx-auto px-4 py-6 sm:py-8 hidden">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6 sm:mb-8">
            <h2 class="text-2xl sm:text-3xl font-bold text-center sm:text-left text-gray-900">–ö–ª–∞—Å—Å—ã</h2>
            <div class="flex gap-2 w-full sm:w-auto">
                <button onclick="openModal('add-class-modal')" class="bg-blue-600 text-white px-4 py-2 rounded-xl font-medium hover:bg-blue-700 transition-all duration-300 hidden flex-1 sm:flex-none text-sm sm:text-base" id="add-class-btn">
                    ‚ûï –ö–ª–∞—Å—Å
                </button>
            </div>
        </div>
        
        <!-- Add Student Section (for teachers/admins) -->
        <div id="add-student-section" class="bg-white p-4 sm:p-6 rounded-2xl shadow-lg border border-gray-200 mb-6 sm:mb-8 hidden">
            <h3 class="text-lg sm:text-xl font-bold text-gray-900 mb-3 sm:mb-4">üë®‚Äçüéì –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 sm:gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">–ò–º—è —É—á–µ–Ω–∏–∫–∞</label>
                    <input type="text" id="student-name" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base" placeholder="–ò–º—è —É—á–µ–Ω–∏–∫–∞">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">–ö–ª–∞—Å—Å</label>
                    <select id="student-class" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base">
                        <!-- options will be populated -->
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">–õ–æ–≥–∏–Ω —É—á–µ–Ω–∏–∫–∞</label>
                    <input type="text" id="student-login" class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base" placeholder="–ª–æ–≥–∏–Ω –¥–ª—è –≤—Ö–æ–¥–∞">
                </div>
            </div>
            <div class="mt-3">
                <button onclick="addStudent()" class="bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700 transition-all duration-300">–î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</button>
            </div>
        </div>
        
        <div id="classes-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Class cards injected by JS -->
        </div>
    </div>

    <!-- Lessons Page -->
    <div id="lessons-page" class="page container mx-auto px-4 py-6 sm:py-8 hidden">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">–ó–∞–Ω—è—Ç–∏—è</h2>
            <!-- optionally add controls -->
        </div>
        <div id="lessons-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- lessons loaded by JS -->
        </div>
    </div>

    <!-- Practice Page -->
    <div id="practice-page" class="page container mx-auto px-4 py-6 sm:py-8 hidden">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">–ü—Ä–∞–∫—Ç–∏–∫–∞ –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</h2>
        </div>
        
        <div class="mb-8 bg-white p-6 rounded-2xl shadow-lg">
            <h3 class="text-xl font-bold text-blue-600 mb-4">–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
            <div class="flex items-center">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                    <span class="text-blue-600 font-bold text-xl" id="progress-percent">0%</span>
                </div>
                <div class="flex-1">
                    <div class="flex justify-between mb-1">
                        <span class="text-sm font-medium">–£—Ä–æ–≤–µ–Ω—å 1 –∏–∑ 4</span>
                        <span class="text-sm font-medium" id="progress-text">0/8 —É—Ä–æ–∫–æ–≤</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mb-6">
            <h3 class="text-xl font-bold text-blue-600 mb-4">–£—Ä–æ–≤–Ω–∏ –æ–±—É—á–µ–Ω–∏—è</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="practice-level" onclick="startPractice('beginner')">
                    <div class="flex items-center mb-2">
                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center mr-3">
                            <span class="text-white font-bold">1</span>
                        </div>
                        <h3 class="text-xl font-bold">–ù–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å</h3>
                    </div>
                    <p class="mb-3">–û—Å–Ω–æ–≤—ã –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, —á–∏—Å–ª–∞, –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã</p>
                    <div class="flex justify-between items-center">
                        <span>4 —É—Ä–æ–∫–∞</span>
                        <i data-feather="play" class="w-5 h-5"></i>
                    </div>
                </div>
                
                <div class="practice-level locked" id="basic-level">
                    <div class="flex items-center mb-2">
                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center mr-3">
                            <span class="text-white font-bold">2</span>
                        </div>
                        <h3 class="text-xl font-bold">–ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å</h3>
                    </div>
                    <p class="mb-3">–ü—Ä–æ—Å—Ç—ã–µ –¥–∏–∞–ª–æ–≥–∏, –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–µ—Ä–æ–≥–ª–∏—Ñ—ã, –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞</p>
                    <div class="flex justify-between items-center">
                        <span>4 —É—Ä–æ–∫–∞</span>
                        <i data-feather="lock" class="w-5 h-5"></i>
                    </div>
                </div>
                
                <div class="practice-level locked">
                    <div class="flex items-center mb-2">
                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center mr-3">
                            <span class="text-white font-bold">3</span>
                        </div>
                        <h3 class="text-xl font-bold">–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å</h3>
                    </div>
                    <p class="mb-3">–°–ª–æ–∂–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å</p>
                    <div class="flex justify-between items-center">
                        <span>4 —É—Ä–æ–∫–∞</span>
                        <i data-feather="lock" class="w-5 h-5"></i>
                    </div>
                </div>
                
                <div class="practice-level locked">
                    <div class="flex items-center mb-2">
                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center mr-3">
                            <span class="text-white font-bold">4</span>
                        </div>
                        <h3 class="text-xl font-bold">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å</h3>
                    </div>
                    <p class="mb-3">–°–≤–æ–±–æ–¥–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ, —Å–ª–æ–∂–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã, –∏–¥–∏–æ–º—ã</p>
                    <div class="flex justify-between items-center">
                        <span>4 —É—Ä–æ–∫–∞</span>
                        <i data-feather="lock" class="w-5 h-5"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="practice-lessons" class="hidden">
            <h3 class="text-xl font-bold text-blue-600 mb-4" id="level-title">–£—Ä–æ–∫–∏ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è</h3>
            <div id="lessons-list">
                <!-- Lessons will be loaded here -->
            </div>
        </div>
        
        <div id="practice-exercises" class="hidden">
            <!-- Practice exercises will be loaded here -->
        </div>
    </div>

    <!-- Resources Page -->
    <div id="resources-page" class="page container mx-auto px-4 py-6 sm:py-8 hidden">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">–†–µ—Å—É—Ä—Å—ã</h2>
        </div>
        <div id="resources-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- resources injected by JS -->
        </div>
    </div>

    <script>
        // ===============================
        // script.js (–ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        // ===============================

        // Data management with proper synchronization
        function getUsers() {
            return JSON.parse(localStorage.getItem('school-users')) || [];
        }

        function getQuestions() {
            return JSON.parse(localStorage.getItem('school-questions')) || [];
        }

        function getCurrentUser() {
            return JSON.parse(localStorage.getItem('school-currentUser')) || null;
        }

        function getStudents() {
            return JSON.parse(localStorage.getItem('school-students')) || [];
        }

        function getClasses() {
            return JSON.parse(localStorage.getItem('school-classes')) || [];
        }

        function getLessons() {
            return JSON.parse(localStorage.getItem('school-lessons')) || [];
        }

        function getResources() {
            return JSON.parse(localStorage.getItem('school-resources')) || [];
        }

        function getPracticeProgress() {
            return JSON.parse(localStorage.getItem('school-practice-progress')) || {
                completedLessons: [],
                currentLevel: 'beginner',
                unlockedLevels: ['beginner']
            };
        }

        function setUsers(users) {
            localStorage.setItem('school-users', JSON.stringify(users));
        }

        function setQuestions(questions) {
            localStorage.setItem('school-questions', JSON.stringify(questions));
        }

        function setCurrentUser(user) {
            if (user) {
                localStorage.setItem('school-currentUser', JSON.stringify(user));
            } else {
                localStorage.removeItem('school-currentUser');
            }
        }

        function setStudents(students) {
            localStorage.setItem('school-students', JSON.stringify(students));
        }

        function setClasses(classes) {
            localStorage.setItem('school-classes', JSON.stringify(classes));
        }

        function setLessons(lessons) {
            localStorage.setItem('school-lessons', JSON.stringify(lessons));
        }

        function setResources(resources) {
            localStorage.setItem('school-resources', JSON.stringify(resources));
        }

        function setPracticeProgress(progress) {
            localStorage.setItem('school-practice-progress', JSON.stringify(progress));
        }

        // Real-time synchronization system
        function initializeSync() {
            // Listen for storage changes (other tabs)
            window.addEventListener('storage', function(e) {
                if (e.key && e.key.startsWith('school-')) {
                    console.log('üîÑ Data changed in another tab:', e.key);
                    updateAuthUI();
                    updateCurrentPage();
                }
            });
        }

        // Initialize default data
        function initializeData() {
            try {
                let users = getUsers();
                let classes = getClasses();
                let lessons = getLessons();
                let resources = getResources();
                let practiceProgress = getPracticeProgress();

                // Add default admin if not exists
                if (!users.find(u => u.username === 'admin')) {
                    users.push({
                        username: 'admin',
                        password: 'admin123',
                        role: 'admin',
                        name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'
                    });
                    setUsers(users);
                }

                // Initialize classes with proper structure
                if (classes.length === 0) {
                    classes = [
                        { id: '3A', name: '3–ê', grade: '3', letter: '–ê', students: [], teacher: '–ö–Ω—è–∑—Å–∫–∞—è –ê–Ω–Ω–∞ –û–ª–µ–≥–æ–≤–Ω–∞' },
                        { id: '3B', name: '3–ë', grade: '3', letter: '–ë', students: [], teacher: '–ö–Ω—è–∑—Å–∫–∞—è –ê–Ω–Ω–∞ –û–ª–µ–≥–æ–≤–Ω–∞' },
                        { id: '3V', name: '3–í', grade: '3', letter: '–í', students: [], teacher: '–ö–Ω—è–∑—Å–∫–∞—è –ê–Ω–Ω–∞ –û–ª–µ–≥–æ–≤–Ω–∞' },
                        { id: '3G', name: '3–ì', grade: '3', letter: '–ì', students: [], teacher: '–ö–Ω—è–∑—Å–∫–∞—è –ê–Ω–Ω–∞ –û–ª–µ–≥–æ–≤–Ω–∞' },
                        { id: '4B', name: '4–ë', grade: '4', letter: '–ë', students: [], teacher: '–í–µ—Ä–æ–Ω–∏–∫–∞ –Ø–Ω–æ–≤–Ω–∞' },
                        { id: '4V', name: '4–í', grade: '4', letter: '–í', students: [], teacher: '–í–µ—Ä–æ–Ω–∏–∫–∞ –Ø–Ω–æ–≤–Ω–∞' },
                        { id: '5G', name: '5–ì', grade: '5', letter: '–ì', students: [], teacher: '–ö–Ω—è–∑—Å–∫–∞—è –ê–Ω–Ω–∞ –û–ª–µ–≥–æ–≤–Ω–∞' },
                        { id: '6A', name: '6–ê', grade: '6', letter: '–ê', students: [], teacher: '–ö–Ω—è–∑—Å–∫–∞—è –ê–Ω–Ω–∞ –û–ª–µ–≥–æ–≤–Ω–∞' },
                        { id: '7G', name: '7–ì', grade: '7', letter: '–ì', students: [], teacher: '–ö–Ω—è–∑—Å–∫–∞—è –ê–Ω–Ω–∞ –û–ª–µ–≥–æ–≤–Ω–∞' }
                    ];
                    setClasses(classes);
                }

                // Initialize lessons
                if (lessons.length === 0) {
                    lessons = [
                        { id: 1, classId: '3A', day: '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', time: '9:00', subject: '–ö–∏—Ç–∞–π—Å–∫–∏–π –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö' },
                        { id: 2, classId: '4B', day: '–í—Ç–æ—Ä–Ω–∏–∫', time: '10:00', subject: '–†–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π –∫–∏—Ç–∞–π—Å–∫–∏–π' },
                        { id: 3, classId: '5G', day: '–°—Ä–µ–¥–∞', time: '11:00', subject: '–ö–∏—Ç–∞–π—Å–∫–∞—è –ø–∏—Å—å–º–µ–Ω–Ω–æ—Å—Ç—å' },
                        { id: 4, classId: '6A', day: '–ß–µ—Ç–≤–µ—Ä–≥', time: '12:00', subject: '–ö–∏—Ç–∞–π—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞' },
                        { id: 5, classId: '7G', day: '–ü—è—Ç–Ω–∏—Ü–∞', time: '13:00', subject: '–ü—Ä–∞–∫—Ç–∏–∫–∞ —Ä–µ—á–∏' }
                    ];
                    setLessons(lessons);
                }

                // Initialize resources with REAL Chinese learning links
                if (resources.length === 0) {
                    resources = [
                        { 
                            id: 1, 
                            title: 'HelloChinese', 
                            description: '–õ—É—á—à–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —Å –Ω—É–ª—è', 
                            link: 'https://www.hellochinese.cc/',
                            type: 'app'
                        },
                        { 
                            id: 2, 
                            title: 'Pleco', 
                            description: '–°–ª–æ–≤–∞—Ä—å –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ–º –∏–µ—Ä–æ–≥–ª–∏—Ñ–æ–≤', 
                            link: 'https://www.pleco.com/',
                            type: 'app'
                        },
                        { 
                            id: 3, 
                            title: 'Chinese Grammar Wiki', 
                            description: '–ü–æ–¥—Ä–æ–±–Ω–∞—è –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞ –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞', 
                            link: 'https://resources.allsetlearning.com/chinese/grammar/',
                            type: 'website'
                        },
                        { 
                            id: 4, 
                            title: 'YouTube: Mandarin Corner', 
                            description: '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —É—Ä–æ–∫–∏ –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ –Ω–∞ YouTube', 
                            link: 'https://www.youtube.com/c/MandarinCorner',
                            type: 'video'
                        },
                        { 
                            id: 5, 
                            title: 'HSK Online', 
                            description: '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —ç–∫–∑–∞–º–µ–Ω—É HSK', 
                            link: 'https://www.hskonline.com/',
                            type: 'website'
                        },
                        { 
                            id: 6, 
                            title: 'Arch Chinese', 
                            description: '–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ –∏–µ—Ä–æ–≥–ª–∏—Ñ–æ–≤', 
                            link: 'https://www.archchinese.com/',
                            type: 'website'
                        },
                        { 
                            id: 7, 
                            title: 'Duolingo –ö–∏—Ç–∞–π—Å–∫–∏–π', 
                            description: '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –æ—Å–Ω–æ–≤', 
                            link: 'https://www.duolingo.com/course/zh/en/learn-chinese',
                            type: 'app'
                        },
                        { 
                            id: 8, 
                            title: 'ChineseForums', 
                            description: '–§–æ—Ä—É–º –¥–ª—è –∏–∑—É—á–∞—é—â–∏—Ö –∫–∏—Ç–∞–π—Å–∫–∏–π —è–∑—ã–∫', 
                            link: 'https://www.chinese-forums.com/',
                            type: 'website'
                        },
                        { 
                            id: 9, 
                            title: 'Skritter', 
                            description: '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∏–µ—Ä–æ–≥–ª–∏—Ñ–æ–≤', 
                            link: 'https://skritter.com/',
                            type: 'app'
                        },
                        { 
                            id: 10, 
                            title: 'YouTube: Yoyo Chinese', 
                            description: '–ö–∞–Ω–∞–ª —Å —É—Ä–æ–∫–∞–º–∏ –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ –¥–ª—è –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π', 
                            link: 'https://www.youtube.com/c/YoyoChinese',
                            type: 'video'
                        },
                        { 
                            id: 11, 
                            title: 'TutorMandarin', 
                            description: '–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞–Ω—è—Ç–∏–π —Å —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞–º–∏', 
                            link: 'https://www.tutormandarin.net/',
                            type: 'website'
                        },
                        { 
                            id: 12, 
                            title: 'Memrise –ö–∏—Ç–∞–π—Å–∫–∏–π', 
                            description: '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —Å–ª–æ–≤ –∏ —Ñ—Ä–∞–∑', 
                            link: 'https://www.memrise.com/courses/english/chinese/',
                            type: 'app'
                        }
                    ];
                    setResources(resources);
                }
                
            } catch (error) {
                console.error('Error initializing data:', error);
            }
        }

        // China facts
        const chinaFacts = [
            "–ö–∏—Ç–∞–π - —Å–∞–º–∞—è –Ω–∞—Å–µ–ª—ë–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞ –≤ –º–∏—Ä–µ —Å –±–æ–ª–µ–µ —á–µ–º 1.4 –º–∏–ª–ª–∏–∞—Ä–¥–∞ –∂–∏—Ç–µ–ª–µ–π",
            "–ö–∏—Ç–∞–π—Å–∫–∏–π —è–∑—ã–∫ —è–≤–ª—è–µ—Ç—Å—è –æ–¥–Ω–∏–º –∏–∑ —à–µ—Å—Ç–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö —è–∑—ã–∫–æ–≤ –û–û–ù",
            "–í –∫–∏—Ç–∞–π—Å–∫–æ–º —è–∑—ã–∫–µ –±–æ–ª–µ–µ 50,000 –∏–µ—Ä–æ–≥–ª–∏—Ñ–æ–≤, –Ω–æ –¥–ª—è —á—Ç–µ–Ω–∏—è –≥–∞–∑–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–Ω–∞—Ç—å 3,000",
            "–í–µ–ª–∏–∫–∞—è –ö–∏—Ç–∞–π—Å–∫–∞—è —Å—Ç–µ–Ω–∞ - —Å–∞–º–æ–µ –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–æ—Ä—É–∂–µ–Ω–∏–µ, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —á–µ–ª–æ–≤–µ–∫–æ–º",
            "–ö–∏—Ç–∞–π —è–≤–ª—è–µ—Ç—Å—è —Ä–æ–¥–∏–Ω–æ–π –º–Ω–æ–≥–∏—Ö –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–π: –±—É–º–∞–≥–∏, –ø–æ—Ä–æ—Ö–∞, –∫–æ–º–ø–∞—Å–∞ –∏ –∫–Ω–∏–≥–æ–ø–µ—á–∞—Ç–∞–Ω–∏—è"
        ];

        let currentFactIndex = 0;

        // –ü–†–û–°–¢–ê–Ø –ò –ù–ê–î–ï–ñ–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
        function showNotification(message, type = 'success') {
            console.log('üîî Notification:', message, 'Type:', type);
            
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const simpleNotification = document.createElement('div');
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∏–ª–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            let bgColor, borderColor, icon;
            switch(type) {
                case 'error':
                    bgColor = '#fef2f2';
                    borderColor = '#ef4444';
                    icon = '‚ùå';
                    break;
                case 'warning':
                    bgColor = '#fffbeb';
                    borderColor = '#f59e0b';
                    icon = '‚ö†Ô∏è';
                    break;
                case 'info':
                    bgColor = '#eff6ff';
                    borderColor = '#3b82f6';
                    icon = '‚ÑπÔ∏è';
                    break;
                default: // success
                    bgColor = '#f0fdf4';
                    borderColor = '#22c55e';
                    icon = '‚úÖ';
            }
            
            simpleNotification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                border: 2px solid ${borderColor};
                border-left: 6px solid ${borderColor};
                padding: 16px 20px;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 500px;
                min-width: 300px;
                font-family: system-ui, -apple-system, sans-serif;
                font-size: 16px;
                color: #1f2937;
                display: flex;
                align-items: center;
                gap: 12px;
                animation: slideIn 0.5s ease-out;
            `;
            
            const iconSpan = document.createElement('span');
            iconSpan.textContent = icon;
            iconSpan.style.fontSize = '20px';
            
            const textSpan = document.createElement('span');
            textSpan.textContent = message;
            textSpan.style.flex = '1';
            textSpan.style.lineHeight = '1.4';
            
            const closeBtn = document.createElement('button');
            closeBtn.textContent = '√ó';
            closeBtn.style.cssText = `
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
                padding: 0;
                width: 30px;
                height: 30px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: #6b7280;
                border-radius: 50%;
                transition: background-color 0.2s;
            `;
            closeBtn.onmouseover = function() {
                this.style.backgroundColor = 'rgba(0,0,0,0.1)';
            };
            closeBtn.onmouseout = function() {
                this.style.backgroundColor = 'transparent';
            };
            closeBtn.onclick = function() {
                simpleNotification.style.animation = 'slideOut 0.5s ease-in';
                setTimeout(() => {
                    if (simpleNotification.parentNode) {
                        simpleNotification.remove();
                    }
                }, 500);
            };
            
            simpleNotification.appendChild(iconSpan);
            simpleNotification.appendChild(textSpan);
            simpleNotification.appendChild(closeBtn);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ç–µ–ª–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
            document.body.appendChild(simpleNotification);
            
            // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 8 —Å–µ–∫—É–Ω–¥
            const autoRemove = setTimeout(() => {
                if (simpleNotification.parentNode) {
                    simpleNotification.style.animation = 'slideOut 0.5s ease-in';
                    setTimeout(() => {
                        if (simpleNotification.parentNode) {
                            simpleNotification.remove();
                        }
                    }, 500);
                }
            }, 8000);
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
            simpleNotification.onmouseenter = function() {
                clearTimeout(autoRemove);
            };
            
            // –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ —É—Ö–æ–¥–µ –∫—É—Ä—Å–æ—Ä–∞
            simpleNotification.onmouseleave = function() {
                setTimeout(() => {
                    if (simpleNotification.parentNode) {
                        simpleNotification.style.animation = 'slideOut 0.5s ease-in';
                        setTimeout(() => {
                            if (simpleNotification.parentNode) {
                                simpleNotification.remove();
                            }
                        }, 500);
                    }
                }, 3000);
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
            if (!document.getElementById('notification-animations')) {
                const style = document.createElement('style');
                style.id = 'notification-animations';
                style.textContent = `
                    @keyframes slideIn {
                        from {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }
                    @keyframes slideOut {
                        from {
                            transform: translateX(0);
                            opacity: 1;
                        }
                        to {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Check if user has permission to edit
        function hasPermission() {
            const currentUser = getCurrentUser();
            return currentUser !== null && (currentUser.role === 'teacher' || currentUser.role === 'admin');
        }

        // Check if user is admin
        function isAdmin() {
            const currentUser = getCurrentUser();
            return currentUser !== null && currentUser.role === 'admin';
        }

        // Update current page content
        function updateCurrentPage() {
            const activePage = document.querySelector('.page.active');
            if (activePage) {
                const pageId = activePage.id.replace('-page', '');
                loadPageContent(pageId);
            }
        }

        // Page management with animations - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø
        function showPage(pageId) {
            console.log('üîÑ Switching to page:', pageId);
            
            // Hide all pages with animation
            document.querySelectorAll('.page').forEach(page => {
                if (page.classList.contains('active')) {
                    page.style.opacity = '0';
                    page.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        page.classList.remove('active');
                        page.classList.add('hidden');
                    }, 300);
                }
            });
            
            // Show selected page with animation
            setTimeout(() => {
                const targetPage = document.getElementById(pageId + '-page');
                if (targetPage) {
                    targetPage.classList.remove('hidden');
                    targetPage.classList.add('active');
                    setTimeout(() => {
                        targetPage.style.opacity = '1';
                        targetPage.style.transform = 'translateY(0)';
                    }, 50);
                }
                
                // Update active nav - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ö–û–î
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    item.style.background = 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)';
                });
                
                document.querySelectorAll(`[data-page="${pageId}"]`).forEach(item => {
                    item.classList.add('active');
                    item.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                });
                
                // Load page-specific content
                loadPageContent(pageId);
                
                // Close mobile menu
                const mobileMenu = document.getElementById('mobile-menu');
                if (mobileMenu) mobileMenu.classList.add('hidden');
                const menuIcon = document.querySelector('#mobile-menu-button i');
                if (menuIcon) {
                    menuIcon.setAttribute('data-feather', 'menu');
                    feather.replace();
                }
            }, 300);
        }

        function loadPageContent(pageId) {
            console.log('üìÑ Loading content for page:', pageId);
            switch(pageId) {
                case 'main':
                    // –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                    break;
                case 'teachers':
                    loadTeachersPage();
                    break;
                case 'classes':
                    loadClassesPage();
                    break;
                case 'lessons':
                    loadLessonsPage();
                    break;
                case 'practice':
                    loadPracticePage();
                    break;
                case 'resources':
                    loadResourcesPage();
                    break;
                default:
                    console.warn('Unknown page:', pageId);
            }
        }

        // Load Teachers Page
        function loadTeachersPage() {
            const teachersContainer = document.getElementById('teachers-container');
            const addTeacherBtn = document.getElementById('add-teacher-btn');
            
            if (!teachersContainer) return;
            
            const users = getUsers();
            
            // Show/hide add teacher button for admin
            if (addTeacherBtn) {
                if (isAdmin()) {
                    addTeacherBtn.classList.remove('hidden');
                } else {
                    addTeacherBtn.classList.add('hidden');
                }
            }
            
            // Get all teachers
            const teachers = users.filter(user => user.role === 'teacher');
            
            teachersContainer.innerHTML = '';
            
            if (teachers.length === 0) {
                teachersContainer.innerHTML = `
                    <div class="col-span-3 text-center py-12">
                        <i data-feather="users" class="w-16 h-16 text-gray-400 mx-auto mb-4"></i>
                        <p class="text-gray-600 font-medium text-lg mb-2">–£—á–∏—Ç–µ–ª—è –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                        ${isAdmin() ? `
                            <p class="text-gray-500 text-sm">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —É—á–∏—Ç–µ–ª—è" –≤—ã—à–µ</p>
                        ` : `
                            <p class="text-gray-500 text-sm">–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–∏—Ç–µ–ª–µ–π</p>
                        `}
                    </div>
                `;
            } else {
                teachers.forEach(teacher => {
                    const teacherElement = document.createElement('div');
                    teacherElement.className = 'bg-white p-4 sm:p-6 rounded-2xl shadow-lg border border-gray-200 text-center transform hover:scale-105 transition-all duration-300';
                    teacherElement.style.animation = 'fadeIn 0.6s ease-out';
                    teacherElement.innerHTML = `
                        <div class="w-20 h-20 sm:w-24 sm:h-24 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full mx-auto mb-3 sm:mb-4 flex items-center justify-center shadow-inner">
                            <i data-feather="user" class="w-10 h-10 sm:w-12 sm:h-12 text-blue-600"></i>
                        </div>
                        <h3 class="text-lg sm:text-xl font-bold text-blue-600 mb-2">${teacher.name}</h3>
                        <div class="flex items-center justify-center mb-3">
                            <i data-feather="award" class="w-4 h-4 text-yellow-500 mr-2"></i>
                            <p class="text-gray-700 font-medium text-sm sm:text-base">–£—á–∏—Ç–µ–ª—å –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</p>
                        </div>
                        <div class="bg-gray-50 p-2 sm:p-3 rounded-lg mb-3">
                            <p class="text-gray-600 text-xs sm:text-sm font-mono">–õ–æ–≥–∏–Ω: ${teacher.username}</p>
                        </div>
                        ${isAdmin() ? `
                            <button onclick="deleteTeacher('${teacher.username}')" class="bg-red-600 text-white px-3 py-2 rounded-lg font-medium hover:bg-red-700 transition-all duration-300 flex items-center justify-center mx-auto text-sm">
                                <i data-feather="trash-2" class="w-3 h-3 sm:w-4 sm:h-4 mr-2"></i>
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        ` : ''}
                    `;
                    teachersContainer.appendChild(teacherElement);
                });
            }
            
            feather.replace();
        }

        // Add Teacher Function
        function addTeacher() {
            if (!isAdmin()) {
                showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å —É—á–∏—Ç–µ–ª–µ–π', 'error');
                return;
            }
            
            const name = document.getElementById('teacher-name').value;
            const login = document.getElementById('teacher-login').value;
            const password = document.getElementById('teacher-password').value;
            
            if (!name || !login || !password) {
                showNotification('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            const users = getUsers();
            
            if (users.find(u => u.username === login)) {
                showNotification('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'error');
                return;
            }
            
            const newTeacher = {
                username: login,
                password: password,
                role: 'teacher',
                name: name
            };
            
            users.push(newTeacher);
            setUsers(users);
            
            // Clear form
            document.getElementById('teacher-name').value = '';
            document.getElementById('teacher-login').value = '';
            document.getElementById('teacher-password').value = '';
            
            showNotification(`üéâ –£—á–∏—Ç–µ–ª—å ${name} –¥–æ–±–∞–≤–ª–µ–Ω!`, 'success');
            closeModal('add-teacher-modal');
            
            // Update UI
            loadTeachersPage();
        }

        // Delete Teacher Function
        function deleteTeacher(username) {
            if (!isAdmin()) {
                showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —É—á–∏—Ç–µ–ª–µ–π', 'error');
                return;
            }
            
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —É—á–∏—Ç–µ–ª—è?')) return;
            
            const users = getUsers();
            const userIndex = users.findIndex(u => u.username === username);
            if (userIndex !== -1) {
                users.splice(userIndex, 1);
                setUsers(users);
                showNotification('üóëÔ∏è –£—á–∏—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω', 'success');
                loadTeachersPage();
            }
        }

        // Load Classes Page
        function loadClassesPage() {
            const classesContainer = document.getElementById('classes-container');
            const addStudentSection = document.getElementById('add-student-section');
            const studentClassSelect = document.getElementById('student-class');
            const addClassBtn = document.getElementById('add-class-btn');
            
            if (!classesContainer) return;
            
            const classes = getClasses();
            const students = getStudents();
            
            // Show/hide add class button for admin
            if (addClassBtn) {
                if (isAdmin()) {
                    addClassBtn.classList.remove('hidden');
                } else {
                    addClassBtn.classList.add('hidden');
                }
            }
            
            // Show/hide add student section based on permissions
            if (addStudentSection) {
                if (hasPermission()) {
                    addStudentSection.classList.remove('hidden');
                    
                    // Populate class select
                    if (studentClassSelect) {
                        studentClassSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å</option>';
                        classes.forEach(classItem => {
                            const option = document.createElement('option');
                            option.value = classItem.id;
                            option.textContent = classItem.name;
                            studentClassSelect.appendChild(option);
                        });
                    }
                } else {
                    addStudentSection.classList.add('hidden');
                }
            }
            
            // Render classes
            classesContainer.innerHTML = '';
            
            if (classes.length === 0) {
                classesContainer.innerHTML = `
                    <div class="col-span-4 text-center py-12">
                        <i data-feather="layers" class="w-16 h-16 text-gray-400 mx-auto mb-4"></i>
                        <p class="text-gray-600 font-medium text-lg mb-2">–ö–ª–∞—Å—Å—ã –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                        ${isAdmin() ? `
                            <p class="text-gray-500 text-sm">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∞—Å—Å" –≤—ã—à–µ</p>
                        ` : `
                            <p class="text-gray-500 text-sm">–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤</p>
                        `}
                    </div>
                `;
            } else {
                // Sort classes by grade and letter (convert grade to number if needed)
                const sortedClasses = [...classes].sort((a, b) => {
                    const ag = parseInt(a.grade, 10);
                    const bg = parseInt(b.grade, 10);
                    if (ag !== bg) return ag - bg;
                    return a.letter.localeCompare(b.letter, 'ru');
                });
                
                sortedClasses.forEach(classItem => {
                    const classStudents = students.filter(student => student.class === classItem.id);
                    
                    const classCard = document.createElement('div');
                    classCard.className = 'bg-white p-4 sm:p-6 rounded-2xl shadow-lg border border-gray-200 text-center class-card cursor-pointer';
                    classCard.style.animation = 'fadeIn 0.6s ease-out';
                    classCard.onclick = function() {
                        showTeacherInfo(classItem.teacher, classItem.name);
                    };
                    classCard.innerHTML = `
                        <div class="w-14 h-14 sm:w-16 sm:h-16 bg-blue-100 rounded-full mx-auto mb-3 sm:mb-4 flex items-center justify-center">
                            <i data-feather="users" class="w-6 h-6 sm:w-8 sm:h-8 text-blue-600"></i>
                        </div>
                        <h3 class="text-lg sm:text-xl font-bold text-blue-600 mb-2">${classItem.name} –∫–ª–∞—Å—Å</h3>
                        <p class="text-gray-700 font-medium mb-3 text-sm sm:text-base">${classStudents.length} —É—á–µ–Ω–∏–∫–æ–≤</p>
                        <div class="max-h-24 sm:max-h-32 overflow-y-auto text-xs sm:text-sm">
                            ${classStudents.map(student => `
                                <div class="text-gray-600 py-1 border-b border-gray-100">${student.name}</div>
                            `).join('')}
                            ${classStudents.length === 0 ? '<p class="text-gray-500 py-2">–ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤</p>' : ''}
                        </div>
                        <div class="mt-3">
                            <p class="text-sm text-gray-600">–£—á–∏—Ç–µ–ª—å: ${classItem.teacher}</p>
                            <p class="text-xs text-blue-500 mt-1">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</p>
                        </div>
                        ${isAdmin() ? `
                            <button onclick="event.stopPropagation(); deleteClass('${classItem.id}')" class="mt-3 bg-red-600 text-white px-3 py-1 rounded-lg text-xs sm:text-sm hover:bg-red-700 transition-all duration-300">
                                –£–¥–∞–ª–∏—Ç—å –∫–ª–∞—Å—Å
                            </button>
                        ` : ''}
                    `;
                    classesContainer.appendChild(classCard);
                });
            }
            
            feather.replace();
        }

        // Show teacher information modal
        function showTeacherInfo(teacherName, className) {
            let teacherInfo = '';
            
            if (teacherName === '–ö–Ω—è–∑—Å–∫–∞—è –ê–Ω–Ω–∞ –û–ª–µ–≥–æ–≤–Ω–∞') {
                teacherInfo = `
                    <div class="teacher-info">
                        <div class="w-32 h-32 bg-blue-100 rounded-full flex items-center justify-center mb-4">
                            <i data-feather="user" class="w-16 h-16 text-blue-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${teacherName}</h3>
                        <p class="text-gray-600 mb-4">–£—á–∏—Ç–µ–ª—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –∏ –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–æ–≤</p>
                        <div class="teacher-details">
                            <p><strong>–ö–ª–∞—Å—Å:</strong> ${className}</p>
                            <p><strong>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:</strong> –í—ã—Å—à–µ–µ</p>
                            <p><strong>–£—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ:</strong> –ú–∏–Ω—Å–∫–∏–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –ª–∏–Ω–≥–≤–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç</p>
                            <p><strong>–°—Ç–∞–∂:</strong> –ú–µ–Ω–µ–µ –≥–æ–¥–∞</p>
                            <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> –ú–æ–ª–æ–¥–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç</p>
                            <p><strong>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</strong> –î–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—é —à–∫–æ–ª—ã</p>
                        </div>
                    </div>
                `;
            } else if (teacherName === '–í–µ—Ä–æ–Ω–∏–∫–∞ –Ø–Ω–æ–≤–Ω–∞') {
                teacherInfo = `
                    <div class="teacher-info">
                        <div class="w-32 h-32 bg-green-100 rounded-full flex items-center justify-center mb-4">
                            <i data-feather="user" class="w-16 h-16 text-green-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${teacherName}</h3>
                        <p class="text-gray-600 mb-4">–£—á–∏—Ç–µ–ª—å –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</p>
                        <div class="teacher-details">
                            <p><strong>–ö–ª–∞—Å—Å:</strong> ${className}</p>
                            <p><strong>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:</strong> –í—ã—Å—à–µ–µ –ª–∏–Ω–≥–≤–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è - –∫–∏—Ç–∞–π—Å–∫–∏–π —è–∑—ã–∫</p>
                            <p><strong>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã:</strong> 5 –ª–µ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</p>
                            <p><strong>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:</strong> –£—á–∞—Å—Ç–∏–µ –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö –æ–±–º–µ–Ω–∞ —Å –ö–∏—Ç–∞–µ–º</p>
                            <p><strong>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</strong> –î–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—é —à–∫–æ–ª—ã</p>
                        </div>
                    </div>
                `;
            } else {
                teacherInfo = `
                    <div class="teacher-info">
                        <div class="w-32 h-32 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                            <i data-feather="user" class="w-16 h-16 text-gray-600"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${teacherName}</h3>
                        <p class="text-gray-600 mb-4">–£—á–∏—Ç–µ–ª—å –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</p>
                        <div class="teacher-details">
                            <p><strong>–ö–ª–∞—Å—Å:</strong> ${className}</p>
                            <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—á–∏—Ç–µ–ª–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ.</p>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('teacher-modal-title').textContent = `–£—á–∏—Ç–µ–ª—å: ${teacherName}`;
            document.getElementById('teacher-modal-content').innerHTML = teacherInfo;
            openModal('teacher-modal');
            feather.replace();
        }

        // Add Class Function (fixed to update UI immediately)
        function addClass() {
            if (!isAdmin()) {
                showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∫–ª–∞—Å—Å—ã', 'error');
                return;
            }
            
            const grade = document.getElementById('class-grade').value;
            const letter = document.getElementById('class-letter').value;
            
            if (!grade || !letter) {
                showNotification('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å –∏ –±—É–∫–≤—É', 'error');
                return;
            }
            
            const classId = grade + letter;
            const className = grade + ' ' + letter;
            
            const classes = getClasses();
            
            // Check if class already exists
            if (classes.find(c => c.id === classId)) {
                showNotification('‚ùå –¢–∞–∫–æ–π –∫–ª–∞—Å—Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'error');
                return;
            }
            
            const newClass = {
                id: classId,
                name: className,
                grade: grade,
                letter: letter,
                students: [],
                teacher: '–ö–Ω—è–∑—Å–∫–∞—è –ê–Ω–Ω–∞ –û–ª–µ–≥–æ–≤–Ω–∞' // Default teacher
            };
            
            classes.push(newClass);
            setClasses(classes);
            
            showNotification(`üéâ –ö–ª–∞—Å—Å ${className} –¥–æ–±–∞–≤–ª–µ–Ω!`, 'success');
            closeModal('add-class-modal');
            
            // Update UI immediately
            updateAuthUI();
            updateCurrentPage();
        }

        // Delete Class Function
        function deleteClass(classId) {
            if (!isAdmin()) {
                showNotification('‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –∫–ª–∞—Å—Å—ã', 'error');
                return;
            }
            
            let classes = getClasses();
            let students = getStudents();
            
            const classItem = classes.find(c => c.id === classId);
            if (!classItem) return;
            
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–ª–∞—Å—Å ${classItem.name}? –í—Å–µ —É—á–µ–Ω–∏–∫–∏ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`)) return;
            
            // Remove class
            const classIndex = classes.findIndex(c => c.id === classId);
            if (classIndex !== -1) {
                classes.splice(classIndex, 1);
                setClasses(classes);
            }
            
            // Remove students from this class
            students = students.filter(student => student.class !== classId);
            setStudents(students);
            
            showNotification(`üóëÔ∏è –ö–ª–∞—Å—Å ${classItem.name} —É–¥–∞–ª–µ–Ω`, 'success');
            
            // Update UI
            loadClassesPage();
        }

        // Load Lessons Page
        function loadLessonsPage() {
            const lessonsContainer = document.getElementById('lessons-container');
            if (!lessonsContainer) return;
            
            const lessons = getLessons();
            const classes = getClasses();
            
            lessonsContainer.innerHTML = '';
            
            if (lessons.length === 0) {
                lessonsContainer.innerHTML = `
                    <div class="col-span-2 text-center py-8">
                        <i data-feather="calendar" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                        <p class="text-gray-600 font-medium">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ</p>
                    </div>
                `;
            } else {
                lessons.forEach((lesson, index) => {
                    const classItem = classes.find(c => c.id === lesson.classId);
                    const lessonElement = document.createElement('div');
                    lessonElement.className = 'bg-blue-50 p-3 sm:p-4 rounded-xl border border-blue-100 lesson-card';
                    lessonElement.style.animation = `fadeIn 0.6s ease-out ${index * 0.1}s both`;
                    lessonElement.innerHTML = `
                        <div class="flex items-center mb-2">
                            <i data-feather="clock" class="w-4 h-4 text-blue-500 mr-2"></i>
                            <span class="font-medium text-gray-800 text-sm sm:text-base">${lesson.day}, ${lesson.time}</span>
                        </div>
                        <p class="text-gray-800 font-medium text-sm sm:text-base">${lesson.subject}</p>
                        <p class="text-xs sm:text-sm text-gray-600 mt-1">${classItem?.name || lesson.classId} –∫–ª–∞—Å—Å</p>
                        <p class="text-xs sm:text-sm text-blue-600 mt-1">–£—á–∏—Ç–µ–ª—å: ${classItem?.teacher || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω'}</p>
                    `;
                    lessonsContainer.appendChild(lessonElement);
                });
            }
            
            feather.replace();
        }

        // Load Practice Page
        function loadPracticePage() {
            const practiceProgress = getPracticeProgress();
            const completedLessons = practiceProgress.completedLessons;
            const unlockedLevels = practiceProgress.unlockedLevels;
            
            // Update progress
            const totalLessons = 16; // 4 —É—Ä–æ–≤–Ω—è –ø–æ 4 —É—Ä–æ–∫–∞
            const completedCount = completedLessons.length;
            const progressPercent = Math.round((completedCount / totalLessons) * 100);
            
            document.getElementById('progress-percent').textContent = `${progressPercent}%`;
            document.getElementById('progress-text').textContent = `${completedCount}/${totalLessons} —É—Ä–æ–∫–æ–≤`;
            document.getElementById('progress-fill').style.width = `${progressPercent}%`;
            
            // Update level accessibility
            const basicLevel = document.getElementById('basic-level');
            if (unlockedLevels.includes('basic')) {
                basicLevel.classList.remove('locked');
                basicLevel.classList.add('practice-level');
                basicLevel.onclick = function() { startPractice('basic'); };
                basicLevel.querySelector('i').setAttribute('data-feather', 'play');
            } else {
                basicLevel.classList.add('locked');
                basicLevel.classList.remove('practice-level');
                basicLevel.onclick = null;
                basicLevel.querySelector('i').setAttribute('data-feather', 'lock');
            }
            
            feather.replace();
        }

        // Start practice function
        function startPractice(level) {
            const practiceLessons = document.getElementById('practice-lessons');
            const practiceExercises = document.getElementById('practice-exercises');
            
            practiceLessons.classList.remove('hidden');
            practiceExercises.classList.add('hidden');
            
            const levelTitle = document.getElementById('level-title');
            const lessonsList = document.getElementById('lessons-list');
            
            // Set level title
            if (level === 'beginner') {
                levelTitle.textContent = '–£—Ä–æ–∫–∏ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è';
            } else if (level === 'basic') {
                levelTitle.textContent = '–£—Ä–æ–∫–∏ –±–∞–∑–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è';
            }
            
            // Load lessons for the level
            const practiceProgress = getPracticeProgress();
            const completedLessons = practiceProgress.completedLessons;
            
            let lessonsHTML = '';
            const lessons = getLessonsForLevel(level);
            
            lessons.forEach((lesson, index) => {
                const lessonId = `${level}-${index + 1}`;
                const isCompleted = completedLessons.includes(lessonId);
                const isCurrent = !isCompleted && 
                    (index === 0 || completedLessons.includes(`${level}-${index}`));
                
                let lessonClass = 'lesson-item';
                if (isCompleted) {
                    lessonClass += ' lesson-complete';
                } else if (isCurrent) {
                    lessonClass += ' lesson-current';
                } else {
                    lessonClass += ' lesson-locked';
                }
                
                lessonsHTML += `
                    <div class="${lessonClass}" ${isCurrent || isCompleted ? `onclick="startLesson('${level}', ${index + 1})"` : ''}>
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-bold text-lg">${lesson.title}</h4>
                                <p class="mt-1">${lesson.description}</p>
                            </div>
                            <div class="flex items-center">
                                ${isCompleted ? 
                                    '<i data-feather="check-circle" class="w-6 h-6 text-white"></i>' : 
                                    isCurrent ? 
                                    '<i data-feather="play-circle" class="w-6 h-6 text-white"></i>' : 
                                    '<i data-feather="lock" class="w-6 h-6 text-white"></i>'
                                }
                            </div>
                        </div>
                    </div>
                `;
            });
            
            lessonsList.innerHTML = lessonsHTML;
            feather.replace();
        }

        // Get lessons for a specific level
        function getLessonsForLevel(level) {
            const lessons = {
                beginner: [
                    {
                        title: '–£—Ä–æ–∫ 1: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è',
                        description: '–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –≤–µ–∂–ª–∏–≤—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è'
                    },
                    {
                        title: '–£—Ä–æ–∫ 2: –ß–∏—Å–ª–∞',
                        description: '–ß–∏—Å–ª–∞ –æ—Ç 1 –¥–æ 10 –∏ –∏—Ö –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ'
                    },
                    {
                        title: '–£—Ä–æ–∫ 3: –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã',
                        description: '–ü–æ–ª–µ–∑–Ω—ã–µ —Ñ—Ä–∞–∑—ã –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è'
                    },
                    {
                        title: '–£—Ä–æ–∫ 4: –¶–≤–µ—Ç–∞',
                        description: '–ù–∞–∑–≤–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤'
                    }
                ],
                basic: [
                    {
                        title: '–£—Ä–æ–∫ 1: –°–µ–º—å—è',
                        description: '–ù–∞–∑–≤–∞–Ω–∏—è —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏'
                    },
                    {
                        title: '–£—Ä–æ–∫ 2: –ï–¥–∞',
                        description: '–ù–∞–∑–≤–∞–Ω–∏—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –±–ª—é–¥ –∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤'
                    },
                    {
                        title: '–£—Ä–æ–∫ 3: –í—Ä–µ–º—è',
                        description: '–ö–∞–∫ –≥–æ–≤–æ—Ä–∏—Ç—å –æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –¥–∞—Ç–∞—Ö'
                    },
                    {
                        title: '–£—Ä–æ–∫ 4: –ü–æ–≥–æ–¥–∞',
                        description: '–°–ª–æ–≤–∞ –∏ —Ñ—Ä–∞–∑—ã –æ –ø–æ–≥–æ–¥–µ'
                    }
                ]
            };
            
            return lessons[level] || [];
        }

        // Start a specific lesson
        function startLesson(level, lessonNumber) {
            const practiceLessons = document.getElementById('practice-lessons');
            const practiceExercises = document.getElementById('practice-exercises');
            
            practiceLessons.classList.add('hidden');
            practiceExercises.classList.remove('hidden');
            
            const lessonId = `${level}-${lessonNumber}`;
            loadLessonContent(level, lessonNumber);
        }

        // Load lesson content
        function loadLessonContent(level, lessonNumber) {
            const exercisesContainer = document.getElementById('practice-exercises');
            
            let exercisesHTML = '';
            
            if (level === 'beginner') {
                if (lessonNumber === 1) {
                    exercisesHTML = `
                        <div class="practice-exercise">
                            <h3 class="text-xl font-bold text-blue-600 mb-4">–£—Ä–æ–∫ 1: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è</h3>
                            <p class="mb-4">–ò–∑—É—á–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–∞ –∫–∏—Ç–∞–π—Å–∫–æ–º —è–∑—ã–∫–µ:</p>
                            
                            <div class="bg-blue-50 p-4 rounded-lg mb-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-bold">‰Ω†Â•Ω (N«ê h«éo)</span>
                                    <span>–ü—Ä–∏–≤–µ—Ç</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-bold">Ë∞¢Ë∞¢ (Xi√®xi√®)</span>
                                    <span>–°–ø–∞—Å–∏–±–æ</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-bold">ÂÜçËßÅ (Z√†iji√†n)</span>
                                    <span>–ü–æ–∫–∞</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="font-bold">ÂØπ‰∏çËµ∑ (Du√¨buq«ê)</span>
                                    <span>–ò–∑–≤–∏–Ω–∏—Ç–µ</span>
                                </div>
                            </div>
                            
                            <p class="mb-4">–¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –¥–ª—è —Ñ—Ä–∞–∑—ã:</p>
                            <div class="bg-blue-50 p-4 rounded-lg mb-4">
                                <p class="text-lg font-bold text-center">‰Ω†Â•Ω</p>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <button class="bg-white border border-blue-300 p-3 rounded-lg hover:bg-blue-50 transition-all" onclick="checkAnswer(this, 'correct', 'beginner', 1)">–ü—Ä–∏–≤–µ—Ç</button>
                                <button class="bg-white border border-blue-300 p-3 rounded-lg hover:bg-blue-50 transition-all" onclick="checkAnswer(this, 'incorrect', 'beginner', 1)">–°–ø–∞—Å–∏–±–æ</button>
                                <button class="bg-white border border-blue-300 p-3 rounded-lg hover:bg-blue-50 transition-all" onclick="checkAnswer(this, 'incorrect', 'beginner', 1)">–ü–æ–∫–∞</button>
                                <button class="bg-white border border-blue-300 p-3 rounded-lg hover:bg-blue-50 transition-all" onclick="checkAnswer(this, 'incorrect', 'beginner', 1)">–ò–∑–≤–∏–Ω–∏—Ç–µ</button>
                            </div>
                        </div>
                    `;
                } else if (lessonNumber === 2) {
                    exercisesHTML = `
                        <div class="practice-exercise">
                            <h3 class="text-xl font-bold text-blue-600 mb-4">–£—Ä–æ–∫ 2: –ß–∏—Å–ª–∞</h3>
                            <p class="mb-4">–ò–∑—É—á–∏—Ç–µ –∫–∏—Ç–∞–π—Å–∫–∏–µ —á–∏—Å–ª–∞ –æ—Ç 1 –¥–æ 5:</p>
                            
                            <div class="character-grid">
                                <div class="character-card">‰∏Ä <div class="text-sm">1</div></div>
                                <div class="character-card">‰∫å <div class="text-sm">2</div></div>
                                <div class="character-card">‰∏â <div class="text-sm">3</div></div>
                                <div class="character-card">Âõõ <div class="text-sm">4</div></div>
                                <div class="character-card">‰∫î <div class="text-sm">5</div></div>
                            </div>
                            
                            <p class="mb-4">–°–æ–ø–æ—Å—Ç–∞–≤—å—Ç–µ –∫–∏—Ç–∞–π—Å–∫–∏–µ —á–∏—Å–ª–∞ —Å –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:</p>
                            <div class="bg-blue-50 p-4 rounded-lg mb-4">
                                <p class="text-lg font-bold text-center">‰∏â</p>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <button class="bg-white border border-blue-300 p-3 rounded-lg hover:bg-blue-50 transition-all" onclick="checkAnswer(this, 'incorrect', 'beginner', 2)">1</button>
                                <button class="bg-white border border-blue-300 p-3 rounded-lg hover:bg-blue-50 transition-all" onclick="checkAnswer(this, 'incorrect', 'beginner', 2)">2</button>
                                <button class="bg-white border border-blue-300 p-3 rounded-lg hover:bg-blue-50 transition-all" onclick="checkAnswer(this, 'correct', 'beginner', 2)">3</button>
                                <button class="bg-white border border-blue-300 p-3 rounded-lg hover:bg-blue-50 transition-all" onclick="checkAnswer(this, 'incorrect', 'beginner', 2)">4</button>
                            </div>
                        </div>
                    `;
                }
            }
            
            exercisesHTML += `
                <div class="exercise-complete hidden" id="exercise-complete">
                    <i data-feather="check-circle" class="w-16 h-16 text-green-500 mx-auto mb-4"></i>
                    <h3 class="text-xl font-bold text-green-600 mb-2">–û—Ç–ª–∏—á–Ω–æ!</h3>
                    <p class="mb-4">–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–∏ —ç—Ç–æ—Ç —É—Ä–æ–∫.</p>
                    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg" onclick="completeLesson('${level}', ${lessonNumber})">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                </div>
            `;
            
            exercisesContainer.innerHTML = exercisesHTML;
            feather.replace();
        }

        // Check answer function
        function checkAnswer(button, result, level, lessonNumber) {
            const buttons = button.parentElement.querySelectorAll('button');
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn === button) {
                    if (result === 'correct') {
                        btn.classList.add('bg-green-500', 'text-white');
                        showNotification('‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!', 'success');
                        
                        // Show completion message after a delay
                        setTimeout(() => {
                            document.getElementById('exercise-complete').classList.remove('hidden');
                        }, 1500);
                    } else {
                        btn.classList.add('bg-red-500', 'text-white');
                        showNotification('‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑', 'error');
                    }
                }
            });
        }

        // Complete lesson function
        function completeLesson(level, lessonNumber) {
            const lessonId = `${level}-${lessonNumber}`;
            const practiceProgress = getPracticeProgress();
            
            // Add lesson to completed lessons if not already there
            if (!practiceProgress.completedLessons.includes(lessonId)) {
                practiceProgress.completedLessons.push(lessonId);
                
                // Unlock next level if all lessons in current level are completed
                const levelLessons = getLessonsForLevel(level);
                const levelLessonIds = levelLessons.map((_, index) => `${level}-${index + 1}`);
                const allLevelLessonsCompleted = levelLessonIds.every(id => 
                    practiceProgress.completedLessons.includes(id));
                
                if (allLevelLessonsCompleted) {
                    if (level === 'beginner' && !practiceProgress.unlockedLevels.includes('basic')) {
                        practiceProgress.unlockedLevels.push('basic');
                        showNotification('üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –æ—Ç–∫—Ä—ã–ª–∏ –±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å!', 'success');
                    }
                }
                
                setPracticeProgress(practiceProgress);
            }
            
            // Return to practice page
            document.getElementById('practice-exercises').classList.add('hidden');
            document.getElementById('practice-lessons').classList.remove('hidden');
            
            // Reload practice page to update progress
            loadPracticePage();
            startPractice(level);
        }

        // Load Resources Page
        function loadResourcesPage() {
            const resourcesContainer = document.getElementById('resources-container');
            if (!resourcesContainer) return;
            
            const resources = getResources();
            
            resourcesContainer.innerHTML = '';
            
            if (resources.length === 0) {
                resourcesContainer.innerHTML = `
                    <div class="col-span-3 text-center py-8">
                        <i data-feather="book" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                        <p class="text-gray-600 font-medium">–†–µ—Å—É—Ä—Å—ã –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                    </div>
                `;
            } else {
                resources.forEach((resource, index) => {
                    const resourceElement = document.createElement('div');
                    resourceElement.className = 'bg-white p-4 sm:p-6 rounded-2xl shadow-lg border border-gray-200 resource-card';
                    resourceElement.style.animation = `slideUp 0.6s ease-out ${index * 0.1}s both`;
                    
                    let typeIcon = 'external-link';
                    let typeColor = 'blue';
                    if (resource.type === 'app') {
                        typeIcon = 'smartphone';
                        typeColor = 'green';
                    } else if (resource.type === 'video') {
                        typeIcon = 'video';
                        typeColor = 'red';
                    } else if (resource.type === 'website') {
                        typeIcon = 'globe';
                        typeColor = 'blue';
                    }
                    
                    resourceElement.innerHTML = `
                        <div class="flex items-start mb-3">
                            <div class="bg-${typeColor}-100 p-2 rounded-lg mr-3">
                                <i data-feather="${typeIcon}" class="w-5 h-5 text-${typeColor}-600"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-lg sm:text-xl font-bold text-blue-600 mb-1">${resource.title}</h3>
                                <p class="text-gray-700 text-sm sm:text-base mb-3">${resource.description}</p>
                            </div>
                        </div>
                        <a href="${resource.link}" target="_blank" rel="noopener noreferrer" class="bg-blue-600 text-white inline-flex items-center px-4 py-2 rounded-xl text-sm hover:bg-blue-700 transition-all duration-300 w-full justify-center">
                            <i data-feather="external-link" class="w-4 h-4 mr-2"></i>
                            –û—Ç–∫—Ä—ã—Ç—å —Ä–µ—Å—É—Ä—Å
                        </a>
                    `;
                    resourcesContainer.appendChild(resourceElement);
                });
            }
            
            feather.replace();
        }

        // Add Student Function
        function addStudent() {
            if (!hasPermission()) {
                showNotification('‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–µ–Ω–∏–∫–æ–≤. –¢–æ–ª—å–∫–æ —É—á–∏—Ç–µ–ª—è –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å —É—á–µ–Ω–∏–∫–æ–≤.', 'error');
                return;
            }
            
            const name = document.getElementById('student-name').value;
            const studentClass = document.getElementById('student-class').value;
            const login = document.getElementById('student-login').value;
            
            if (!name || !studentClass || !login) {
                showNotification('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            const users = getUsers();
            
            if (users.find(u => u.username === login)) {
                showNotification('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'error');
                return;
            }
            
            // Create user account for student
            const studentUser = {
                username: login,
                password: 'student123', // –ø—Ä–æ—Å—Ç–æ–π –ø–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                role: 'student',
                name: name
            };
            
            users.push(studentUser);
            setUsers(users);
            
            // Add student to students list
            const students = getStudents();
            const newStudent = {
                name: name,
                class: studentClass,
                username: login
            };
            
            students.push(newStudent);
            setStudents(students);
            
            // Clear form
            document.getElementById('student-name').value = '';
            document.getElementById('student-login').value = '';
            
            showNotification(`üéâ –£—á–µ–Ω–∏–∫ ${name} —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–ª–∞—Å—Å! –ü–∞—Ä–æ–ª—å: student123`, 'success');
            
            // Update UI
            loadClassesPage();
        }

        // Facts rotation
        function rotateFacts() {
            currentFactIndex = (currentFactIndex + 1) % chinaFacts.length;
            const factContainer = document.getElementById('fact-container');
            
            factContainer.style.opacity = '0';
            factContainer.style.transform = 'translateY(10px)';
            
            setTimeout(() => {
                factContainer.innerHTML = `<p class="text-lg sm:text-xl font-medium">${chinaFacts[currentFactIndex]}</p>`;
                factContainer.style.opacity = '1';
                factContainer.style.transform = 'translateY(0)';
            }, 300);
        }

        // Theme switching
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.querySelector('#theme-toggle i');
            const currentTheme = body.getAttribute('data-theme');
            
            if (currentTheme === 'day') {
                body.setAttribute('data-theme', 'night');
                body.className = 'bg-gray-900 text-white transition-all duration-500';
                themeIcon.setAttribute('data-feather', 'sun');
                showNotification('üåô –ù–æ—á–Ω–∞—è —Ç–µ–º–∞ –≤–∫–ª—é—á–µ–Ω–∞', 'success');
            } else {
                body.setAttribute('data-theme', 'day');
                body.className = 'bg-white text-gray-900 transition-all duration-500';
                themeIcon.setAttribute('data-feather', 'moon');
                showNotification('‚òÄÔ∏è –î–Ω–µ–≤–Ω–∞—è —Ç–µ–º–∞ –≤–∫–ª—é—á–µ–Ω–∞', 'success');
            }
            feather.replace();
        }

        // Mobile menu
        function setupMobileMenu() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', function() {
                    const menu = document.getElementById('mobile-menu');
                    const menuIcon = document.querySelector('#mobile-menu-button i');
                    
                    menu.classList.toggle('hidden');
                    
                    if (menu.classList.contains('hidden')) {
                        menuIcon.setAttribute('data-feather', 'menu');
                    } else {
                        menuIcon.setAttribute('data-feather', 'x');
                    }
                    feather.replace();
                });
            }
        }

        // Modal functions
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.style.opacity = '1';
            }, 10);
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // Clear auth forms
        function clearAuthForms() {
            const e = (id) => { const el = document.getElementById(id); if (el) el.value = ''; };
            e('login-username'); e('login-password'); e('reg-username'); e('reg-password'); e('reg-confirm-password');
        }

        // Auth functions
        function openAuthModal(type) {
            openModal('auth-modal');
            if (type === 'register') {
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('register-form').classList.remove('hidden');
                document.getElementById('modal-title').textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
            } else {
                document.getElementById('register-form').classList.add('hidden');
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('modal-title').textContent = '–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É';
            }
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            clearAuthForms();
        }

        function login() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            if (!username || !password) {
                showNotification('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            // Check for admin
            if (username === 'admin' && password === 'admin123') {
                setCurrentUser({ username: 'admin', role: 'admin', name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' });
                showNotification('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ', 'success');
                closeModal('auth-modal');
                
                // Update UI immediately
                updateAuthUI();
                showPage('teachers');
                return;
            }
            
            const users = getUsers();
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                setCurrentUser(user);
                
                let welcomeMessage = `üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.name || user.username}!`;
                if (user.role === 'teacher') {
                    welcomeMessage += ' –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —É—á–µ–Ω–∏–∫–æ–≤';
                } else if (user.role === 'student') {
                    welcomeMessage += ' –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã —É—á–∏—Ç–µ–ª—è–º';
                }
                
                showNotification(welcomeMessage, 'success');
                closeModal('auth-modal');
                
                // Update UI immediately
                updateAuthUI();
                if (user.role === 'teacher' || user.role === 'admin') {
                    showPage('teachers');
                } else {
                    showPage('main');
                }
            } else {
                showNotification('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
            }
        }

        // üî• –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π register() ‚Äî —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏–Ω–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function register() {
            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;
            const role = document.getElementById('reg-role').value;
            
            if (!username || !password || !confirmPassword) {
                showNotification('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('‚ùå –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç', 'error');
                return;
            }
            
            const users = getUsers();
            
            if (users.find(u => u.username === username)) {
                showNotification('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'error');
                return;
            }
            
            const newUser = { 
                username: username, 
                password: password, 
                role: role,
                name: username
            };
            
            users.push(newUser);
            setUsers(users);
            
            // Auto login after registration
            setCurrentUser(newUser);
            
            let successMessage = 'üéâ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ! ';
            if (role === 'teacher') {
                successMessage += '–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —É—á–µ–Ω–∏–∫–æ–≤';
            } else {
                successMessage += '–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã —É—á–∏—Ç–µ–ª—è–º';
            }
            
            showNotification(successMessage, 'success');
            
            closeModal('auth-modal');
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
            const regFields = ['reg-username','reg-password','reg-confirm-password'];
            regFields.forEach(id => { const el = document.getElementById(id); if (el) el.value = ''; });
            
            // Update UI immediately
            updateAuthUI();
            updateCurrentPage(); // <-- –í–ê–ñ–ù–û: –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ—è–≤–∏–ª–∏—Å—å –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
            if (role === 'teacher' || role === 'admin') {
                showPage('teachers');
            } else {
                showPage('main');
            }
        }

        function forgotPassword() {
            showNotification('üîê –î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —à–∫–æ–ª—ã.', 'info');
        }

        function updateAuthUI() {
            const authButtons = document.getElementById('auth-buttons');
            const mobileAuthSection = document.getElementById('mobile-auth-section');
            const qaButton = document.getElementById('qa-button');
            const addTeacherBtn = document.getElementById('add-teacher-btn');
            const addStudentSection = document.getElementById('add-student-section');
            const addClassBtn = document.getElementById('add-class-btn');
            
            if (!authButtons) return;
            
            const currentUser = getCurrentUser();
            
            if (currentUser) {
                // User is logged in
                authButtons.innerHTML = `
                    <div class="flex items-center space-x-2 sm:space-x-3 bg-green-500/20 p-2 rounded-xl border border-green-500/30">
                        <i data-feather="user-check" class="w-4 h-4 sm:w-5 sm:h-5 text-green-400"></i>
                        <span class="text-white font-semibold text-sm sm:text-base">${currentUser.name || currentUser.username}</span>
                        <div class="h-4 sm:h-6 w-px bg-white/30"></div>
                        <span class="text-green-300 text-xs sm:text-sm px-2 py-1 bg-green-500/20 rounded-lg">
                            ${currentUser.role === 'admin' ? 'üëë –ê–¥–º–∏–Ω' : 
                              currentUser.role === 'teacher' ? 'üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å' : 'üéí –£—á–µ–Ω–∏–∫'}
                        </span>
                        <button onclick="logout()" class="bg-red-600 text-white px-2 py-1 sm:px-3 sm:py-1 rounded-lg text-xs sm:text-sm hover:bg-red-700 transition-all duration-300 flex items-center">
                            <i data-feather="log-out" class="w-3 h-3 sm:w-4 sm:h-4 mr-1"></i>
                            –í—ã–π—Ç–∏
                        </button>
                    </div>
                `;
                
                if (mobileAuthSection) {
                    mobileAuthSection.innerHTML = `
                        <div class="pt-4 border-t border-blue-600 space-y-3">
                            <div class="text-center p-3 bg-green-500/20 rounded-xl border border-green-500/30">
                                <div class="text-green-300 font-semibold">${currentUser.name || currentUser.username}</div>
                                <div class="text-green-400 text-sm mt-1">
                                    ${currentUser.role === 'admin' ? 'üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : 
                                      currentUser.role === 'teacher' ? 'üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å' : 'üéí –£—á–µ–Ω–∏–∫'}
                                </div>
                            </div>
                            <button onclick="logout()" class="w-full px-4 py-3 bg-red-600 text-white rounded-xl font-medium flex items-center justify-center transition-all duration-300 hover:bg-red-700">
                                <i data-feather="log-out" class="w-4 h-4 mr-2"></i>
                                –í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
                            </button>
                        </div>
                    `;
                }
                
                // Show Q&A button for all logged in users
                if (qaButton) {
                    qaButton.classList.remove('hidden');
                    qaButton.innerHTML = `<i data-feather="message-circle" class="w-4 h-4 sm:w-5 sm:h-5"></i>`;
                    qaButton.title = "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å —É—á–∏—Ç–µ–ª—é";
                }
                
                // Update permissions for admin/teacher features
                if (addTeacherBtn) {
                    if (isAdmin()) {
                        addTeacherBtn.classList.remove('hidden');
                    } else {
                        addTeacherBtn.classList.add('hidden');
                    }
                }
                
                if (addClassBtn) {
                    if (isAdmin()) {
                        addClassBtn.classList.remove('hidden');
                    } else {
                        addClassBtn.classList.add('hidden');
                    }
                }
                
                if (addStudentSection) {
                    if (hasPermission()) {
                        addStudentSection.classList.remove('hidden');
                    } else {
                        addStudentSection.classList.add('hidden');
                    }
                }
                
            } else {
                // User is not logged in
                authButtons.innerHTML = `
                    <div class="flex items-center space-x-2 sm:space-x-3">
                        <button onclick="openAuthModal('register')" class="bg-red-600 text-white px-3 py-2 sm:px-5 sm:py-2.5 rounded-xl font-medium hover:bg-red-700 transition-all duration-300 flex items-center text-xs sm:text-base">
                            <i data-feather="user-plus" class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"></i>
                            –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                        </button>
                        <button onclick="openAuthModal('login')" class="bg-blue-700 text-white px-3 py-2 sm:px-5 sm:py-2.5 rounded-xl font-medium hover:bg-blue-800 transition-all duration-300 flex items-center text-xs sm:text-base">
                            <i data-feather="log-in" class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"></i>
                            –í–æ–π—Ç–∏
                        </button>
                    </div>
                `;
                
                if (mobileAuthSection) {
                    mobileAuthSection.innerHTML = `
                        <div class="pt-4 border-t border-blue-600 space-y-3">
                            <button onclick="openAuthModal('register')" class="w-full px-4 py-3 bg-white text-blue-600 rounded-xl font-medium flex items-center justify-center transition-all duration-300">
                                <i data-feather="user-plus" class="w-4 h-4 mr-2"></i>
                                –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                            </button>
                            <button onclick="openAuthModal('login')" class="w-full mt-2 px-4 py-3 bg-blue-700 text-white rounded-xl font-medium flex items-center justify-center transition-all duration-300">
                                <i data-feather="log-in" class="w-4 h-4 mr-2"></i>
                                –í–æ–π—Ç–∏
                            </button>
                        </div>
                    `;
                }
                
                // Hide Q&A button for anonymous users
                if (qaButton) qaButton.classList.add('hidden');
                if (addTeacherBtn) addTeacherBtn.classList.add('hidden');
                if (addClassBtn) addClassBtn.classList.add('hidden');
                if (addStudentSection) addStudentSection.classList.add('hidden');
            }
            
            feather.replace();
            // –í–∞–∂–Ω–æ: –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è auth UI ‚Äî –æ–±–Ω–æ–≤–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –ø–æ—è–≤–∏–ª—Å—è add-button)
            updateCurrentPage();
        }

        function logout() {
            setCurrentUser(null);
            showNotification('üîí –í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã. –ß—Ç–æ–±—ã —Å–Ω–æ–≤–∞ –≤–æ–π—Ç–∏, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏"', 'info');
            
            // Update UI immediately
            updateAuthUI();
            showPage('main');
        }

        // Q&A functions
        function openQAModal() {
            if (!getCurrentUser()) {
                showNotification('üîí –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–æ–ø—Ä–æ—Å–∞–º –∏ –æ—Ç–≤–µ—Ç–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'warning');
                openAuthModal('login');
                return;
            }
            
            openModal('qa-modal');
            loadQuestions();
        }

        function submitQuestion() {
            const currentUser = getCurrentUser();
            if (!currentUser) {
                showNotification('üîí –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–æ–ø—Ä–æ—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'warning');
                return;
            }
            
            const questionInput = document.getElementById('question-input');
            const question = questionInput.value.trim();
            
            if (!question) {
                showNotification('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å', 'error');
                return;
            }
            
            const questions = getQuestions();
            const newQuestion = {
                id: Date.now(),
                question: question,
                answer: null,
                date: new Date().toLocaleDateString('ru-RU'),
                user: currentUser.username,
                userName: currentUser.name || currentUser.username
            };
            
            questions.push(newQuestion);
            setQuestions(questions);
            
            questionInput.value = '';
            showNotification('‚úÖ –í–∞—à –≤–æ–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —É—á–∏—Ç–µ–ª—è–º!', 'success');
            loadQuestions();
        }

        function loadQuestions() {
            const qaList = document.getElementById('qa-list');
            if (!qaList) return;
            
            const questions = getQuestions();
            const currentUser = getCurrentUser();
            
            qaList.innerHTML = '';
            
            if (questions.length === 0) {
                qaList.innerHTML = `
                    <div class="text-center py-8">
                        <i data-feather="message-circle" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                        <p class="text-gray-600 font-medium">–í–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
                    </div>
                `;
                feather.replace();
                return;
            }
            
            let questionsToShow;
            if (hasPermission()) {
                questionsToShow = questions.slice().reverse();
            } else {
                questionsToShow = questions
                    .filter(q => q.user === currentUser.username)
                    .reverse();
            }
            
            if (questionsToShow.length === 0) {
                qaList.innerHTML = `
                    <div class="text-center py-8">
                        <i data-feather="message-circle" class="w-12 h-12 text-gray-400 mx-auto mb-4"></i>
                        <p class="text-gray-600 font-medium">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤</p>
                    </div>
                `;
                feather.replace();
                return;
            }
            
            questionsToShow.forEach((q, index) => {
                const questionElement = document.createElement('div');
                questionElement.className = 'bg-white p-4 sm:p-5 rounded-2xl shadow-lg border border-gray-200 mb-4';
                questionElement.style.animation = `fadeIn 0.6s ease-out ${index * 0.1}s both`;
                
                let answerSection = '';
                if (q.answer) {
                    answerSection = `
                        <div class="flex items-start bg-green-50 p-3 rounded-lg mt-3">
                            <i data-feather="check-circle" class="w-4 h-4 sm:w-5 sm:h-5 text-green-500 mr-3 mt-0.5"></i>
                            <div class="flex-1">
                                <span class="text-gray-800 font-medium text-sm sm:text-base">${q.answer}</span>
                                <p class="text-xs sm:text-sm text-gray-600 mt-1">–û—Ç–≤–µ—Ç —É—á–∏—Ç–µ–ª—è</p>
                            </div>
                        </div>
                    `;
                } else if (hasPermission()) {
                    answerSection = `
                        <div class="mt-3">
                            <textarea id="answer-${q.id}" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç." class="w-full px-3 py-2 border border-gray-300 rounded-lg text-xs sm:text-sm resize-none h-16 sm:h-20"></textarea>
                            <button onclick="submitAnswer(${q.id})" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-xs sm:text-sm mt-1 hover:bg-blue-700 transition-all duration-300">
                                –û—Ç–≤–µ—Ç–∏—Ç—å
                            </button>
                        </div>
                    `;
                } else {
                    answerSection = `
                        <div class="flex items-start bg-yellow-50 p-3 rounded-lg mt-3">
                            <i data-feather="clock" class="w-4 h-4 sm:w-5 sm:h-5 text-yellow-500 mr-3 mt-0.5"></i>
                            <span class="text-gray-800 font-medium text-sm sm:text-base">–í–æ–ø—Ä–æ—Å –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏ —É—á–∏—Ç–µ–ª—è</span>
                        </div>
                    `;
                }
                
                questionElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="mr-3">
                            <i data-feather="user" class="w-6 h-6 text-gray-500"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="text-gray-800 font-semibold">${q.userName}</div>
                                    <div class="text-xs text-gray-500">${q.date}</div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <p class="text-gray-700">${q.question}</p>
                                ${answerSection}
                            </div>
                        </div>
                    </div>
                `;
                
                qaList.appendChild(questionElement);
            });
            
            feather.replace();
        }

        function submitAnswer(id) {
            if (!hasPermission()) return;
            const el = document.getElementById(`answer-${id}`);
            if (!el) return;
            const answer = el.value.trim();
            if (!answer) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç', 'error');
                return;
            }
            const questions = getQuestions();
            const qIndex = questions.findIndex(q => q.id === id);
            if (qIndex !== -1) {
                questions[qIndex].answer = answer;
                setQuestions(questions);
                showNotification('‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω', 'success');
                loadQuestions();
            }
        }

        // Initialize rotate facts loop & other setup
        function startUI() {
            initializeData();
            initializeSync();
            rotateFacts();
            setInterval(rotateFacts, 8000);
            setupMobileMenu();
            feather.replace();
            updateAuthUI();
            updateCurrentPage();
            
            // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ù–ê–í–ò–ì–ê–¶–ò–ò
            console.log('üéØ Initializing navigation...');
            
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('[data-page]').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    console.log('üñ±Ô∏è Navigation button clicked:', page);
                    if (page) {
                        showPage(page);
                    }
                });
            });

            // QA button
            const qaBtn = document.getElementById('qa-button');
            if (qaBtn) {
                qaBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    openQAModal();
                });
            }

            // Theme button
            const themeBtn = document.getElementById('theme-toggle');
            if (themeBtn) {
                themeBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    toggleTheme();
                });
            }
            
            console.log('‚úÖ Navigation initialized successfully');
        }

        // On DOM loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM fully loaded, starting UI...');
            
            // initial start
            startUI();
        });

        // Fallback for DOMContentLoaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', startUI);
        } else {
            startUI();
        }
    </script>
</body>
</html>
